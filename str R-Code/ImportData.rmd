---
title: "import DataSets"
author: "JaBaKi Studios"
date: "28-9-2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## Booking.com

Here we list the 3 studios from which to download the data :

```{r bdc}


url <- "https://admin.booking.com/hotel/hoteladmin/extranet_ng/manage/search_reservations.html?upcoming_reservations=1&source=nav&hotel_id=4392906&lang=en&ses=3e915e852e81630c46774e403f6c181e&date_from=2021-09-01&date_to=2022-12-31&date_type=arrival"

## First change start date String in url to change
patFrom <- "2021-09-01" ## Old From date
patTo   <- "2022-12-31" ## Old to date

dateFrom <- "2025-09-01" ## New From Date 
dateTo   <- "2026-11-01" ## New to date, Max 20 months in future else error in bdc

## Date-from en date-to kunnen in link worden aangepast. 
url <- sub(patFrom, dateFrom, url, ignore.case = FALSE, perl = FALSE,
           fixed = FALSE, useBytes = FALSE)
url <- sub(patTo, dateTo, url, ignore.case = FALSE, perl = FALSE,
           fixed = FALSE, useBytes = FALSE)

## Dit geldt ook voor accommodatie id
patListing <- "4392906"
CF <- "4392906" ## Accomodation ID to change
RS <- "5615303" ## Accomodation ID to change
GS <- "5620035" ## Accomodation ID to change


urlRS <- sub(patListing, RS, url, ignore.case = FALSE, perl = FALSE,
           fixed = FALSE, useBytes = FALSE) 
urlGS <- sub(patListing, GS, url, ignore.case = FALSE, perl = FALSE,
           fixed = FALSE, useBytes = FALSE) 
urlCF <- sub(patListing, CF, url, ignore.case = FALSE, perl = FALSE,
           fixed = FALSE, useBytes = FALSE) 


```

<button onclick="openImportPopup()" style="background-color: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px;">Import Links</button>

<div id="importPopup" style="display: none; position: fixed; z-index: 1; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.4);">
  <div style="background-color: #fefefe; margin: 15% auto; padding: 20px; border: 1px solid #888; width: 50%; border-radius: 8px;">
    <span onclick="closeImportPopup()" style="color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer;">&times;</span>
    <h3>Import Data Links</h3>
    <div style="margin: 10px 0;">
      <h4>Booking.com Studios:</h4>
      <a href="`r urlRS`" target="_blank" style="display: block; margin: 5px 0; padding: 8px; background-color: #f0f0f0; text-decoration: none; border-radius: 4px;">Red Studio (RS)</a>
      <a href="`r urlGS`" target="_blank" style="display: block; margin: 5px 0; padding: 8px; background-color: #f0f0f0; text-decoration: none; border-radius: 4px;">Green Studio (GS)</a>
      <a href="`r urlCF`" target="_blank" style="display: block; margin: 5px 0; padding: 8px; background-color: #f0f0f0; text-decoration: none; border-radius: 4px;">Child Friendly (CF)</a>
    </div>
    <div style="margin: 10px 0;">
      <h4>Airbnb:</h4>
      <a href="https://www.airbnb.nl/hosting/reservations/all" target="_blank" style="display: block; margin: 5px 0; padding: 8px; background-color: #f0f0f0; text-decoration: none; border-radius: 4px;">Alles (Select period & download BTW factuur)</a>
    </div>
    <div style="margin: 10px 0;">
      <h4>JaBaKi Direct:</h4>
      <div style="padding: 8px; background-color: #e8f4f8; border-radius: 4px;">File already at: C:\Users\peter\OneDrive\R\AirBnB\data</div>
    </div>
  </div>
</div>

<script>
function openImportPopup() {
  document.getElementById('importPopup').style.display = 'block';
}

function closeImportPopup() {
  document.getElementById('importPopup').style.display = 'none';
}

window.onclick = function(event) {
  var popup = document.getElementById('importPopup');
  if (event.target == popup) {
    popup.style.display = 'none';
  }
}
</script>

## Further Processing

Run writeJaBaKiMySQL.R\
If wanted Run CreateJabakiResult.R to update existing xlsx file.\

<b>Move to R Finance project for end of Month processing</b>\
Run LoadBookingComChannelFee.R monthly basis based on received monthly invoice\
Run loadAirbnbTax.r monthly basis based on tax income\
Run LoadBnBChannelRevenue.R monthly basis to load revenue and tax based on 1600 acciounts into finance>mutaties






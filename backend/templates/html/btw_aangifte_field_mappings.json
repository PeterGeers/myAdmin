{
  "version": "1.0",
  "template_type": "btw_aangifte_html",
  "description": "BTW Aangifte (VAT Declaration) HTML Report Template",
  "output_format": "html",
  "template_location": {
    "storage_type": "google_drive",
    "file_id": "STORED_IN_tenant_template_config.template_file_id",
    "note": "Template file ID is stored in tenant_template_config table"
  },
  "output_storage": {
    "default_destination": "download",
    "available_destinations": [
      "download",
      "google_drive"
    ],
    "google_drive_folder": "Reports/BTW",
    "note": "User can choose destination when generating report"
  },
  "fields": {
    "administration": {
      "path": "administration",
      "type": "string",
      "description": "Administration/tenant identifier"
    },
    "year": {
      "path": "year",
      "type": "integer",
      "description": "Report year"
    },
    "quarter": {
      "path": "quarter",
      "type": "integer",
      "description": "Quarter number (1-4)"
    },
    "end_date": {
      "path": "end_date",
      "type": "string",
      "format": "date",
      "description": "Quarter end date (YYYY-MM-DD)"
    },
    "generated_date": {
      "path": "generated_date",
      "type": "string",
      "format": "datetime",
      "description": "Report generation timestamp"
    },
    "balance_rows": {
      "path": "balance_rows",
      "type": "string",
      "format": "html",
      "description": "Pre-generated HTML table rows for balance data",
      "note": "Generated by btw_aangifte_generator._format_table_rows()"
    },
    "quarter_rows": {
      "path": "quarter_rows",
      "type": "string",
      "format": "html",
      "description": "Pre-generated HTML table rows for quarter data",
      "note": "Generated by btw_aangifte_generator._format_table_rows()"
    },
    "payment_instruction": {
      "path": "payment_instruction",
      "type": "string",
      "description": "Payment instruction (te betalen/ontvangen)"
    },
    "received_btw": {
      "path": "received_btw",
      "type": "string",
      "format": "currency",
      "description": "Total received BTW (formatted)"
    },
    "prepaid_btw": {
      "path": "prepaid_btw",
      "type": "string",
      "format": "currency",
      "description": "Prepaid BTW amount (formatted)"
    }
  },
  "data_source": {
    "description": "Data comes from mutaties_cache queries",
    "queries": {
      "balance": {
        "method": "Filter by date <= end_date, accounts 2010, 2020, 2021",
        "returns": "List of {Reknum, AccountName, Amount}"
      },
      "quarter": {
        "method": "Filter by year and quarter, accounts 2010, 2020, 2021, 8001, 8002, 8003",
        "returns": "List of {Reknum, AccountName, Amount}"
      }
    }
  },
  "calculations": {
    "total_balance": {
      "formula": "Sum of all balance data (accounts 2010, 2020, 2021)",
      "description": "Total BTW balance up to quarter end"
    },
    "received_btw": {
      "formula": "Sum of accounts 2020, 2021 from quarter data",
      "description": "Total received BTW for the quarter"
    },
    "prepaid_btw": {
      "formula": "Received BTW - Total Balance",
      "description": "Prepaid BTW amount"
    },
    "payment_instruction": {
      "formula": "If Total Balance >= 0: 'te ontvangen', else: 'te betalen'",
      "description": "Payment instruction based on balance"
    }
  },
  "formatting": {
    "locale": "nl_NL",
    "currency": "EUR",
    "date_format": "YYYY-MM-DD",
    "number_decimals": 2,
    "decimal_separator": ",",
    "thousands_separator": "."
  }
}

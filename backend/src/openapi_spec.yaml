openapi: 3.0.0
info:
  title: myAdmin Backend API
  description: Financial Management and Short-Term Rental Backend System
  version: 1.0.0
  contact:
    name: API Support
    email: support@myadmin.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:5000/api
    description: Local development server
  - url: http://localhost:5001/api
    description: Local development server (alternate port)
  - url: https://api.myadmin.com/api
    description: Production server

tags:
  - name: Authentication
    description: Authentication endpoints
  - name: Files
    description: File upload and processing
  - name: Transactions
    description: Financial transaction management
  - name: Banking
    description: Banking data processing
  - name: STR
    description: Short-Term Rental management
  - name: BNB
    description: Bed & Breakfast reporting and analytics
  - name: STR-Channel
    description: STR channel transaction management
  - name: STR-Invoice
    description: STR invoice generation and management
  - name: Pricing
    description: Pricing optimization
  - name: BTW
    description: VAT/BTW reporting
  - name: Reports
    description: Financial reporting
  - name: Health
    description: Service health monitoring
  - name: Tenant Administration
    description: Tenant configuration and user management (Tenant_Admin only)
  - name: Template Management
    description: Template preview, validation, and AI-assisted editing (Tenant_Admin only)
  - name: Tenant Module Management
    description: Tenant module access control

paths:
  /health:
    get:
      tags:
        - Health
      summary: Health check endpoint
      description: Check if the API service is healthy
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

  /test:
    get:
      tags:
        - Health
      summary: Test endpoint
      description: Simple test endpoint to verify API connectivity
      responses:
        '200':
          description: Test successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TestResponse'

  /status:
    get:
      tags:
        - Health
      summary: Get environment status
      description: Get current environment configuration
      responses:
        '200':
          description: Environment status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatusResponse'

  /upload:
    post:
      tags:
        - Files
      summary: Upload and process PDF file
      description: Upload a PDF file for processing and data extraction
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: PDF file to upload
                folderName:
                  type: string
                  description: Target folder for the file
      responses:
        '200':
          description: File processed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UploadResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /approve-transactions:
    post:
      tags:
        - Transactions
      summary: Approve and save transactions
      description: Save approved transactions to the database
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApproveTransactionsRequest'
      responses:
        '200':
          description: Transactions saved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApproveTransactionsResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /banking/scan-files:
    get:
      tags:
        - Banking
      summary: Scan for CSV files
      description: Scan download folder for banking CSV files
      parameters:
        - name: folder
          in: query
          description: Folder path to scan
          required: false
          schema:
            type: string
      responses:
        '200':
          description: List of CSV files found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BankingScanResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /banking/process-files:
    post:
      tags:
        - Banking
      summary: Process banking CSV files
      description: Process selected CSV files and extract transactions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BankingProcessRequest'
      responses:
        '200':
          description: Transactions extracted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BankingProcessResponse'
        '500':
          description: Processing error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /str/upload:
    post:
      tags:
        - STR
      summary: Upload STR file
      description: Upload and process short-term rental booking file
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: STR booking file
                platform:
                  type: string
                  description: Booking platform (airbnb, booking.com, etc.)
      responses:
        '200':
          description: Booking data processed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/STRUploadResponse'
        '400':
          description: Invalid file
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /str/save:
    post:
      tags:
        - STR
      summary: Save STR bookings
      description: Save processed STR bookings to database
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/STRSaveRequest'
      responses:
        '200':
          description: Bookings saved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/STRSaveResponse'
        '500':
          description: Database error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /pricing/generate:
    post:
      tags:
        - Pricing
      summary: Generate pricing recommendations
      description: Generate pricing strategy using AI optimizer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PricingGenerateRequest'
      responses:
        '200':
          description: Pricing recommendations
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PricingGenerateResponse'
        '500':
          description: Generation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /btw/generate-report:
    post:
      tags:
        - BTW
      summary: Generate BTW report
      description: Generate VAT/BTW declaration report
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BTWGenerateRequest'
      responses:
        '200':
          description: BTW report generated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BTWGenerateResponse'
        '500':
          description: Report generation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /reports/aangifte-ib:
    get:
      tags:
        - Reports
      summary: Get Aangifte IB data
      description: Get financial data grouped by Parent and Aangifte
      parameters:
        - name: year
          in: query
          description: Financial year
          required: true
          schema:
            type: string
        - name: administration
          in: query
          description: Administration filter
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Aangifte IB data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AangifteIBResponse'
        '400':
          description: Missing parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # Tenant Administration Endpoints
  /tenant/config:
    get:
      tags:
        - Tenant Administration
      summary: Get tenant configuration
      security:
        - BearerAuth: []
        - TenantHeader: []
      responses:
        '200':
          description: Tenant configuration retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  tenant:
                    type: string
                  configs:
                    type: array
                    items:
                      type: object
        '403':
          description: Tenant admin access required
    post:
      tags:
        - Tenant Administration
      summary: Set tenant configuration
      security:
        - BearerAuth: []
        - TenantHeader: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - config_key
                - config_value
              properties:
                config_key:
                  type: string
                config_value:
                  type: string
                is_secret:
                  type: boolean
      responses:
        '200':
          description: Configuration updated
        '403':
          description: Tenant admin access required

  /tenant/users:
    get:
      tags:
        - Tenant Administration
      summary: Get tenant users
      security:
        - BearerAuth: []
        - TenantHeader: []
      responses:
        '200':
          description: Tenant users retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  users:
                    type: array
                    items:
                      type: object
        '403':
          description: Tenant admin access required

  /tenant/users/{username}/roles:
    post:
      tags:
        - Tenant Administration
      summary: Assign role to user
      security:
        - BearerAuth: []
        - TenantHeader: []
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - role
              properties:
                role:
                  type: string
                  enum: [Finance_CRUD, Finance_Read, Finance_Export, STR_CRUD, STR_Read, STR_Export]
      responses:
        '200':
          description: Role assigned successfully
        '403':
          description: Tenant admin access required

  # Template Management Endpoints
  /tenant-admin/templates/{template_type}:
    get:
      tags:
        - Template Management
      summary: Get current active template
      description: Retrieve the currently active template content and metadata
      security:
        - BearerAuth: []
        - TenantHeader: []
      parameters:
        - name: template_type
          in: path
          required: true
          schema:
            type: string
            enum: [str_invoice_nl, str_invoice_en, btw_aangifte, aangifte_ib, toeristenbelasting, financial_report]
      responses:
        '200':
          description: Template retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  template_type:
                    type: string
                  template_content:
                    type: string
                  field_mappings:
                    type: object
                  metadata:
                    type: object
        '404':
          description: No active template found
        '403':
          description: Tenant admin access required

  /tenant-admin/templates/preview:
    post:
      tags:
        - Template Management
      summary: Generate template preview with sample data
      security:
        - BearerAuth: []
        - TenantHeader: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - template_type
                - template_content
              properties:
                template_type:
                  type: string
                  enum: [str_invoice_nl, str_invoice_en, btw_aangifte, aangifte_ib, toeristenbelasting]
                template_content:
                  type: string
                field_mappings:
                  type: object
      responses:
        '200':
          description: Preview generated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  preview_html:
                    type: string
                  validation:
                    type: object
        '400':
          description: Validation failed
        '403':
          description: Tenant admin access required

  /tenant-admin/templates/validate:
    post:
      tags:
        - Template Management
      summary: Validate template (faster than preview)
      security:
        - BearerAuth: []
        - TenantHeader: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - template_type
                - template_content
              properties:
                template_type:
                  type: string
                template_content:
                  type: string
      responses:
        '200':
          description: Validation completed
        '403':
          description: Tenant admin access required

  /tenant-admin/templates/approve:
    post:
      tags:
        - Template Management
      summary: Approve and activate template
      security:
        - BearerAuth: []
        - TenantHeader: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - template_type
                - template_content
              properties:
                template_type:
                  type: string
                template_content:
                  type: string
                field_mappings:
                  type: object
                notes:
                  type: string
      responses:
        '200':
          description: Template approved and activated
        '403':
          description: Tenant admin access required

  /tenant-admin/templates/ai-help:
    post:
      tags:
        - Template Management
      summary: Get AI-powered fix suggestions
      security:
        - BearerAuth: []
        - TenantHeader: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - template_type
                - template_content
                - validation_errors
              properties:
                template_type:
                  type: string
                template_content:
                  type: string
                validation_errors:
                  type: array
                  items:
                    type: object
      responses:
        '200':
          description: AI suggestions generated
        '403':
          description: Tenant admin access required

  # Tenant Module Management
  /tenant/modules:
    get:
      tags:
        - Tenant Module Management
      summary: Get tenant module access
      security:
        - BearerAuth: []
        - TenantHeader: []
      responses:
        '200':
          description: Module access retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  modules:
                    type: object
                    properties:
                      Finance:
                        type: boolean
                      STR:
                        type: boolean
    post:
      tags:
        - Tenant Module Management
      summary: Update tenant module access
      security:
        - BearerAuth: []
        - TenantHeader: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - module
                - enabled
              properties:
                module:
                  type: string
                  enum: [Finance, STR]
                enabled:
                  type: boolean
      responses:
        '200':
          description: Module access updated
        '403':
          description: Tenant admin access required

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtained from AWS Cognito authentication
    TenantHeader:
      type: apiKey
      in: header
      name: X-Tenant
      description: Tenant identifier for multi-tenant operations

  schemas:
    # Standard Response Formats
    StandardResponse:
      type: object
      properties:
        success:
          type: boolean
          description: Request success status
        data:
          type: object
          description: Response data
        error:
          type: string
          description: Error message (if any)
        status:
          type: string
          enum: [success, error]
          description: Request status

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          example: "Invalid request parameters"
        status:
          type: string
          example: "error"

    # Health Endpoints
    HealthResponse:
      type: object
      properties:
        status:
          type: string
          example: "healthy"
        endpoints:
          type: array
          items:
            type: string
          example: ["/api/str/upload", "/api/str/scan-files"]

    TestResponse:
      type: object
      properties:
        status:
          type: string
          example: "Server is working"

    StatusResponse:
      type: object
      properties:
        mode:
          type: string
          enum: [Test, Production]
          example: "Test"
        database:
          type: string
          example: "testfinance"
        folder:
          type: string
          example: "testFacturen"

    # File Upload
    UploadResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        filename:
          type: string
          example: "invoice.pdf"
        folder:
          type: string
          example: "storage/Amazon"
        extractedText:
          type: string
          example: "Invoice content extracted..."
        vendorData:
          type: object
          description: Vendor-specific parsed data
        transactions:
          type: array
          items:
            type: object
            description: Extracted transaction data

    # Transaction Approval
    ApproveTransactionsRequest:
      type: object
      properties:
        transactions:
          type: array
          items:
            type: object
            properties:
              description:
                type: string
                example: "Amazon purchase"
              amount:
                type: number
                example: 125.50
              date:
                type: string
                format: date
                example: "2025-12-15"
              category:
                type: string
                example: "Office Supplies"

    ApproveTransactionsResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        savedTransactions:
          type: array
          items:
            type: object
            description: Saved transaction records
        message:
          type: string
          example: "Successfully saved 5 transactions"

    # Banking
    BankingScanResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        files:
          type: array
          items:
            type: string
          example: ["transactions_2025.csv"]
        folder:
          type: string
          example: "/downloads"

    BankingProcessRequest:
      type: object
      properties:
        files:
          type: array
          items:
            type: string
          example: ["/downloads/transactions_2025.csv"]
        test_mode:
          type: boolean
          example: true

    BankingProcessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        transactions:
          type: array
          items:
            type: object
            description: Extracted banking transactions
        count:
          type: integer
          example: 42
        test_mode:
          type: boolean
          example: true

    # STR (Short-Term Rental)
    STRUploadResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        realised:
          type: array
          items:
            type: object
            description: Realised bookings
        planned:
          type: array
          items:
            type: object
            description: Planned bookings
        summary:
          type: object
          description: Booking summary statistics
        platform:
          type: string
          example: "airbnb"

    STRSaveRequest:
      type: object
      properties:
        realised:
          type: array
          items:
            type: object
            description: Realised booking data
        planned:
          type: array
          items:
            type: object
            description: Planned booking data

    STRSaveResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        results:
          type: object
          description: Save operation results
        message:
          type: string
          example: "Processed 15 realised, 8 planned bookings"

    # Pricing
    PricingGenerateRequest:
      type: object
      properties:
        months:
          type: integer
          example: 14
        listing:
          type: string
          example: "Child Friendly"

    PricingGenerateResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        result:
          type: object
          description: Pricing strategy data
        listing:
          type: string
          example: "Child Friendly"
        generated_at:
          type: string
          format: date-time

    # BTW (VAT)
    BTWGenerateRequest:
      type: object
      properties:
        administration:
          type: string
          example: "Main"
        year:
          type: string
          example: "2025"
        quarter:
          type: string
          example: "Q1"

    BTWGenerateResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        report:
          type: object
          description: Generated BTW report data

    # Reports
    AangifteIBResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: array
          items:
            type: object
            properties:
              Parent:
                type: string
                example: "4000"
              Aangifte:
                type: string
                example: "Omzet"
              Amount:
                type: number
                example: 12500.50
        available_years:
          type: array
          items:
            type: string
          example: ["2024", "2025"]
        available_administrations:
          type: array
          items:
            type: string
          example: ["Main", "Secondary"]

    # Tenant Filtering Schemas
    TenantAccessDeniedResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          example: "Access denied to administration: UnauthorizedTenant"
        status:
          type: string
          example: "error"

    # BNB Response Schemas
    BNBListingDataResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: array
          items:
            type: object
            properties:
              listing:
                type: string
                example: "Child Friendly"
              channel:
                type: string
                example: "Airbnb"
              year:
                type: string
                example: "2024"
              revenue:
                type: number
                example: 15000.50
              bookings:
                type: integer
                example: 45
              administration:
                type: string
                example: "PeterPrive"

    BNBChannelDataResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: array
          items:
            type: object
            properties:
              channel:
                type: string
                example: "Airbnb"
              revenue:
                type: number
                example: 25000.75
              bookings:
                type: integer
                example: 78
              administration:
                type: string
                example: "PeterPrive"

    BNBTableDataResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: array
          items:
            type: object
            properties:
              listing:
                type: string
                example: "Child Friendly"
              channel:
                type: string
                example: "Airbnb"
              guestName:
                type: string
                example: "John Doe"
              reservationCode:
                type: string
                example: "ABC123"
              checkIn:
                type: string
                format: date
                example: "2024-06-15"
              checkOut:
                type: string
                format: date
                example: "2024-06-20"
              revenue:
                type: number
                example: 750.00
              administration:
                type: string
                example: "PeterPrive"

    BNBGuestBookingsResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: array
          items:
            type: object
            properties:
              guestName:
                type: string
                example: "John Doe"
              totalBookings:
                type: integer
                example: 3
              totalRevenue:
                type: number
                example: 2250.00
              lastBooking:
                type: string
                format: date
                example: "2024-08-15"
              administration:
                type: string
                example: "PeterPrive"

    BNBActualsResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: array
          items:
            type: object
            properties:
              month:
                type: string
                example: "2024-06"
              actualRevenue:
                type: number
                example: 8500.00
              plannedRevenue:
                type: number
                example: 9000.00
              variance:
                type: number
                example: -500.00
              administration:
                type: string
                example: "PeterPrive"

    BNBFilterOptionsResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        years:
          type: array
          items:
            type: string
          example: ["2023", "2024", "2025"]
        listings:
          type: array
          items:
            type: string
          example: ["Child Friendly", "Adult Only", "Pet Friendly"]
        channels:
          type: array
          items:
            type: string
          example: ["Airbnb", "Booking.com", "Direct"]
        note:
          type: string
          example: "Filter options are limited to user's accessible tenants"

    BNBViolinDataResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: array
          items:
            type: object
            properties:
              category:
                type: string
                example: "Revenue Distribution"
              values:
                type: array
                items:
                  type: number
                example: [500, 750, 1000, 1250, 1500]
              administration:
                type: string
                example: "PeterPrive"

    BNBReturningGuestsResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            totalGuests:
              type: integer
              example: 150
            returningGuests:
              type: integer
              example: 45
            returnRate:
              type: number
              example: 30.0
            topReturningGuests:
              type: array
              items:
                type: object
                properties:
                  guestName:
                    type: string
                    example: "John Doe"
                  bookingCount:
                    type: integer
                    example: 5
                  totalRevenue:
                    type: number
                    example: 3750.00

    # STR Channel Schemas
    STRChannelSaveRequest:
      type: object
      properties:
        transactions:
          type: array
          items:
            type: object
            properties:
              Administration:
                type: string
                example: "PeterPrive"
              TransactionDate:
                type: string
                format: date
                example: "2024-06-15"
              Amount:
                type: number
                example: 750.00
              Description:
                type: string
                example: "Airbnb booking payment"
              ReferenceNumber:
                type: string
                example: "REF123456"

    STRChannelSaveResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        savedTransactions:
          type: integer
          example: 15
        message:
          type: string
          example: "Successfully saved 15 transactions"

    # STR Invoice Schemas
    STRInvoiceGenerateRequest:
      type: object
      properties:
        bookingId:
          type: string
          example: "booking_123"
        administration:
          type: string
          example: "PeterPrive"
        templateType:
          type: string
          enum: ["nl", "en"]
          example: "nl"

    STRInvoiceGenerateResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        invoiceUrl:
          type: string
          example: "https://drive.google.com/file/d/abc123/view"
        invoiceId:
          type: string
          example: "INV-2024-001"
        bookingId:
          type: string
          example: "booking_123"
        administration:
          type: string
          example: "PeterPrive"

    STRTemplateUploadResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Template upload completed for tenant: PeterPrive"
        results:
          type: array
          items:
            type: object
            properties:
              template:
                type: string
                example: "PeterPrive_str_invoice_nl.html"
              status:
                type: string
                example: "uploaded"
              url:
                type: string
                example: "https://drive.google.com/file/d/abc123/view"
              tenant:
                type: string
                example: "PeterPrive"
        tenant:
          type: string
          example: "PeterPrive"
        tenant_folder_url:
          type: string
          example: "https://drive.google.com/drive/folders/xyz789"

  # BNB Endpoints
  /bnb/bnb-listing-data:
    get:
      tags:
        - BNB
      summary: Get BNB listing data
      description: Retrieve BNB listing performance data filtered by user's accessible tenants
      security:
        - BearerAuth: []
        - TenantHeader: []
      parameters:
        - name: year
          in: query
          description: Year filter
          required: false
          schema:
            type: string
            example: "2024"
        - name: listing
          in: query
          description: Listing filter
          required: false
          schema:
            type: string
            example: "Child Friendly"
        - name: channel
          in: query
          description: Channel filter
          required: false
          schema:
            type: string
            example: "Airbnb"
      responses:
        '200':
          description: BNB listing data filtered by tenant
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BNBListingDataResponse'
        '403':
          description: Access denied - insufficient tenant permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TenantAccessDeniedResponse'

  /bnb/bnb-channel-data:
    get:
      tags:
        - BNB
      summary: Get BNB channel data
      description: Retrieve BNB channel performance data filtered by user's accessible tenants
      security:
        - BearerAuth: []
        - TenantHeader: []
      parameters:
        - name: year
          in: query
          description: Year filter
          required: false
          schema:
            type: string
            example: "2024"
        - name: listing
          in: query
          description: Listing filter
          required: false
          schema:
            type: string
            example: "Child Friendly"
        - name: channel
          in: query
          description: Channel filter
          required: false
          schema:
            type: string
            example: "Airbnb"
      responses:
        '200':
          description: BNB channel data filtered by tenant
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BNBChannelDataResponse'
        '403':
          description: Access denied - insufficient tenant permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TenantAccessDeniedResponse'

  /bnb/bnb-table:
    get:
      tags:
        - BNB
      summary: Get BNB table data
      description: Retrieve BNB table view data filtered by user's accessible tenants
      security:
        - BearerAuth: []
        - TenantHeader: []
      parameters:
        - name: year
          in: query
          description: Year filter
          required: false
          schema:
            type: string
            example: "2024"
        - name: listing
          in: query
          description: Listing filter
          required: false
          schema:
            type: string
            example: "Child Friendly"
        - name: channel
          in: query
          description: Channel filter
          required: false
          schema:
            type: string
            example: "Airbnb"
      responses:
        '200':
          description: BNB table data filtered by tenant
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BNBTableDataResponse'
        '403':
          description: Access denied - insufficient tenant permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TenantAccessDeniedResponse'

  /bnb/bnb-guest-bookings:
    get:
      tags:
        - BNB
      summary: Get BNB guest bookings
      description: Retrieve BNB guest booking data filtered by user's accessible tenants
      security:
        - BearerAuth: []
        - TenantHeader: []
      parameters:
        - name: year
          in: query
          description: Year filter
          required: false
          schema:
            type: string
            example: "2024"
        - name: listing
          in: query
          description: Listing filter
          required: false
          schema:
            type: string
            example: "Child Friendly"
        - name: channel
          in: query
          description: Channel filter
          required: false
          schema:
            type: string
            example: "Airbnb"
      responses:
        '200':
          description: BNB guest bookings filtered by tenant
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BNBGuestBookingsResponse'
        '403':
          description: Access denied - insufficient tenant permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TenantAccessDeniedResponse'

  /bnb/bnb-actuals:
    get:
      tags:
        - BNB
      summary: Get BNB actuals data
      description: Retrieve BNB actual performance data filtered by user's accessible tenants
      security:
        - BearerAuth: []
        - TenantHeader: []
      parameters:
        - name: year
          in: query
          description: Year filter
          required: false
          schema:
            type: string
            example: "2024"
        - name: listing
          in: query
          description: Listing filter
          required: false
          schema:
            type: string
            example: "Child Friendly"
        - name: channel
          in: query
          description: Channel filter
          required: false
          schema:
            type: string
            example: "Airbnb"
      responses:
        '200':
          description: BNB actuals data filtered by tenant
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BNBActualsResponse'
        '403':
          description: Access denied - insufficient tenant permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TenantAccessDeniedResponse'

  /bnb/bnb-filter-options:
    get:
      tags:
        - BNB
      summary: Get BNB filter options
      description: Retrieve available filter options (years, listings, channels) for user's accessible tenants
      security:
        - BearerAuth: []
        - TenantHeader: []
      responses:
        '200':
          description: BNB filter options filtered by tenant
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BNBFilterOptionsResponse'
        '403':
          description: Access denied - insufficient tenant permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TenantAccessDeniedResponse'

  /bnb/bnb-violin-data:
    get:
      tags:
        - BNB
      summary: Get BNB violin plot data
      description: Retrieve BNB violin plot data filtered by user's accessible tenants
      security:
        - BearerAuth: []
        - TenantHeader: []
      parameters:
        - name: year
          in: query
          description: Year filter
          required: false
          schema:
            type: string
            example: "2024"
        - name: listing
          in: query
          description: Listing filter
          required: false
          schema:
            type: string
            example: "Child Friendly"
        - name: channel
          in: query
          description: Channel filter
          required: false
          schema:
            type: string
            example: "Airbnb"
      responses:
        '200':
          description: BNB violin plot data filtered by tenant
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BNBViolinDataResponse'
        '403':
          description: Access denied - insufficient tenant permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TenantAccessDeniedResponse'

  /bnb/bnb-returning-guests:
    get:
      tags:
        - BNB
      summary: Get BNB returning guests data
      description: Retrieve BNB returning guests analysis filtered by user's accessible tenants
      security:
        - BearerAuth: []
        - TenantHeader: []
      parameters:
        - name: year
          in: query
          description: Year filter
          required: false
          schema:
            type: string
            example: "2024"
        - name: listing
          in: query
          description: Listing filter
          required: false
          schema:
            type: string
            example: "Child Friendly"
        - name: channel
          in: query
          description: Channel filter
          required: false
          schema:
            type: string
            example: "Airbnb"
      responses:
        '200':
          description: BNB returning guests data filtered by tenant
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BNBReturningGuestsResponse'
        '403':
          description: Access denied - insufficient tenant permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TenantAccessDeniedResponse'

  # STR Channel Endpoints
  /str-channel/save:
    post:
      tags:
        - STR-Channel
      summary: Save STR channel transactions
      description: Save STR channel transactions with tenant validation
      security:
        - BearerAuth: []
        - TenantHeader: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/STRChannelSaveRequest'
      responses:
        '200':
          description: Transactions saved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/STRChannelSaveResponse'
        '403':
          description: Access denied - transactions contain unauthorized tenant data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TenantAccessDeniedResponse'

  # STR Invoice Endpoints
  /str-invoice/generate-invoice:
    post:
      tags:
        - STR-Invoice
      summary: Generate STR invoice
      description: Generate invoice for STR booking with tenant validation
      security:
        - BearerAuth: []
        - TenantHeader: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/STRInvoiceGenerateRequest'
      responses:
        '200':
          description: Invoice generated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/STRInvoiceGenerateResponse'
        '403':
          description: Access denied - booking belongs to unauthorized tenant
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TenantAccessDeniedResponse'

  /str-invoice/upload-template:
    post:
      tags:
        - STR-Invoice
      summary: Upload STR invoice template
      description: Upload tenant-specific STR invoice templates to Google Drive
      security:
        - BearerAuth: []
        - TenantHeader: []
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                templates:
                  type: array
                  items:
                    type: string
                    format: binary
                  description: Template files to upload
      responses:
        '200':
          description: Templates uploaded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/STRTemplateUploadResponse'
        '403':
          description: Access denied - insufficient tenant permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TenantAccessDeniedResponse'


> frontend@0.1.0 test
> react-scripts test TemplateUpload.test.tsx --no-coverage --watchAll=false

FAIL src/components/TenantAdmin/TemplateManagement/__tests__/TemplateUpload.test.tsx (6.437 s)
  TemplateUpload
    Rendering
      ÔêÜ renders template type selector (66 ms)
      ÔêÜ renders file upload button (74 ms)
      ÔêÜ renders upload button (disabled initially) (18 ms)
      ÔêÜ renders help instructions (11 ms)
    Template Type Selection
      ÔêÜ displays all template type options (78 ms)
      ÔêÜ shows description when template type is selected (102 ms)
      ÔêÜ clears errors when template type changes (156 ms)
    File Upload
      ÔêÜ accepts HTML file selection (74 ms)
      ÔêÜ displays file size (62 ms)
      ├ù rejects non-HTML files (1090 ms)
      ÔêÜ rejects files larger than 5MB (323 ms)
      ÔêÜ changes button text after file selection (71 ms)
    Field Mappings
      ├ù validates JSON format (165 ms)
      ├ù accepts valid JSON (134 ms)
      ÔêÜ accepts empty field mappings (52 ms)
      Ôùï skipped hides field mappings by default
      Ôùï skipped shows field mappings when toggled
    Form Validation
      ├ù shows error when uploading without file (1148 ms)
      ├ù shows error when uploading without template type (1107 ms)
      ÔêÜ enables upload button when all required fields are filled (155 ms)
    Upload Submission
      ÔêÜ calls onUpload with correct parameters (234 ms)
      ├ù calls onUpload with field mappings when provided (244 ms)
    Loading and Disabled States
      ÔêÜ disables all inputs when loading (22 ms)
      ÔêÜ disables all inputs when disabled prop is true (31 ms)
      ÔêÜ shows loading text on upload button when loading (7 ms)

  ÔùÅ TemplateUpload ÔÇ║ File Upload ÔÇ║ rejects non-HTML files

    Unable to find an element with the text: /only html files/i. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    <body>
      <div>
        <div>
          <div
            data-invalid="false"
          >
            <label>
              Template Type
            </label>
            <select
              aria-label="Template Type"
            >
              <option
                value=""
              >
                Select template type
              </option>
              <option
                value="str_invoice_nl"
              >
                STR Invoice (Dutch)
              </option>
              <option
                value="str_invoice_en"
              >
                STR Invoice (English)
              </option>
              <option
                value="btw_aangifte"
              >
                BTW Aangifte
              </option>
              <option
                value="aangifte_ib"
              >
                Aangifte IB
              </option>
              <option
                value="toeristenbelasting"
              >
                Toeristenbelasting
              </option>
              <option
                value="financial_report"
              >
                Financial Report
              </option>
            </select>
          </div>
          <div
            data-invalid="false"
          >
            <label>
              Template File
            </label>
            <input
              accept=".html,.htm"
              aria-label="Upload HTML template file"
              style="display: none;"
              type="file"
            />
            <div>
              <button>
                Browse Files
              </button>
            </div>
            <div>
              HTML files only, max 5MB
            </div>
          </div>
          <div>
            <button>
              Ôû╝
               Advanced: Field Mappings (Optional)
            </button>
            <div>
              <div
                data-invalid="false"
              >
                <label>
                  Field Mappings (JSON)
                </label>
                <textarea
                  aria-label="Field Mappings (JSON)"
                  placeholder="{\"field_name\": \"custom_value\"}"
                  rows="6"
                >
                  {}
                </textarea>
                <div>
                  Optional: Customize field mappings in JSON format. Leave empty to use defaults.
                </div>
              </div>
            </div>
          </div>
          <button
            disabled=""
          >
            Upload & Preview Template
          </button>
          <div>
            <p
              font-weight="bold"
              mb="2"
            >
              ­ƒôØ Upload Instructions
            </p>
            <div
              color="gray.300"
              font-size="xs"
            >
              <p>
                1. Select the template type from the dropdown
              </p>
              <p>
                2. Choose your HTML template file (max 5MB)
              </p>
              <p>
                3. Optionally configure field mappings
              </p>
              <p>
                4. Click "Upload & Preview Template" to validate
              </p>
            </div>
          </div>
        </div>
      </div>
    </body>

      195 |       await user.upload(input, file);
      196 |       
    > 197 |       await waitFor(() => {
          |                    ^
      198 |         expect(screen.getByText(/only html files/i)).toBeInTheDocument();
      199 |       });
      200 |     });

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (src/components/TenantAdmin/TemplateManagement/__tests__/TemplateUpload.test.tsx:197:20)

  ÔùÅ TemplateUpload ÔÇ║ Field Mappings ÔÇ║ validates JSON format

    Expected repeat modifier or release modifier or "}" but found " " in "{invalid json}"
        See https://testing-library.com/docs/user-event/keyboard
        for more information about how userEvent parses your input.

      262 |       const textarea = screen.getByRole('textbox', { name: /field mappings \(json\)/i });
      263 |       await user.clear(textarea);
    > 264 |       await user.type(textarea, '{invalid json}');
          |       ^
      265 |       
      266 |       // Try to upload
      267 |       const select = screen.getByRole('combobox', { name: /template type/i });

      at readTag (node_modules/@testing-library/user-event/dist/cjs/utils/keyDef/readNextDescriptor.js:58:15)
      at Object.readNextDescriptor (node_modules/@testing-library/user-event/dist/cjs/utils/keyDef/readNextDescriptor.js:26:66)
      at Object.parseKeyDef (node_modules/@testing-library/user-event/dist/cjs/keyboard/parseKeyDef.js:18:118)
      at Object.keyboard (node_modules/@testing-library/user-event/dist/cjs/keyboard/index.js:8:33)
      at Object.type (node_modules/@testing-library/user-event/dist/cjs/utility/type.js:17:16)
      at Object.asyncWrapper (node_modules/@testing-library/react/dist/pure.js:88:22)
      at Object.<anonymous> (src/components/TenantAdmin/TemplateManagement/__tests__/TemplateUpload.test.tsx:264:7)

  ÔùÅ TemplateUpload ÔÇ║ Field Mappings ÔÇ║ accepts valid JSON

    Expected repeat modifier or release modifier or "}" but found "f" in "{"field": "value"}"
        See https://testing-library.com/docs/user-event/keyboard
        for more information about how userEvent parses your input.

      293 |       const textarea = screen.getByRole('textbox', { name: /field mappings \(json\)/i });
      294 |       await user.clear(textarea);
    > 295 |       await user.type(textarea, '{"field": "value"}');
          |       ^
      296 |       
      297 |       // Should not show error
      298 |       expect(screen.queryByText(/invalid json format/i)).not.toBeInTheDocument();

      at readTag (node_modules/@testing-library/user-event/dist/cjs/utils/keyDef/readNextDescriptor.js:58:15)
      at Object.readNextDescriptor (node_modules/@testing-library/user-event/dist/cjs/utils/keyDef/readNextDescriptor.js:26:66)
      at Object.parseKeyDef (node_modules/@testing-library/user-event/dist/cjs/keyboard/parseKeyDef.js:18:118)
      at Object.keyboard (node_modules/@testing-library/user-event/dist/cjs/keyboard/index.js:8:33)
      at Object.type (node_modules/@testing-library/user-event/dist/cjs/utility/type.js:17:16)
      at Object.asyncWrapper (node_modules/@testing-library/react/dist/pure.js:88:22)
      at Object.<anonymous> (src/components/TenantAdmin/TemplateManagement/__tests__/TemplateUpload.test.tsx:295:7)

  ÔùÅ TemplateUpload ÔÇ║ Form Validation ÔÇ║ shows error when uploading without file

    Unable to find an element with the text: /please select a file/i. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    <body>
      <div>
        <div>
          <div
            data-invalid="false"
          >
            <label>
              Template Type
            </label>
            <select
              aria-label="Template Type"
            >
              <option
                value=""
              >
                Select template type
              </option>
              <option
                value="str_invoice_nl"
              >
                STR Invoice (Dutch)
              </option>
              <option
                value="str_invoice_en"
              >
                STR Invoice (English)
              </option>
              <option
                value="btw_aangifte"
              >
                BTW Aangifte
              </option>
              <option
                value="aangifte_ib"
              >
                Aangifte IB
              </option>
              <option
                value="toeristenbelasting"
              >
                Toeristenbelasting
              </option>
              <option
                value="financial_report"
              >
                Financial Report
              </option>
            </select>
            <div>
              Short-term rental invoice in Dutch
            </div>
          </div>
          <div
            data-invalid="false"
          >
            <label>
              Template File
            </label>
            <input
              accept=".html,.htm"
              aria-label="Upload HTML template file"
              style="display: none;"
              type="file"
            />
            <div>
              <button>
                Browse Files
              </button>
            </div>
            <div>
              HTML files only, max 5MB
            </div>
          </div>
          <div>
            <button>
              Ôû╝
               Advanced: Field Mappings (Optional)
            </button>
            <div>
              <div
                data-invalid="false"
              >
                <label>
                  Field Mappings (JSON)
                </label>
                <textarea
                  aria-label="Field Mappings (JSON)"
                  placeholder="{\"field_name\": \"custom_value\"}"
                  rows="6"
                >
                  {}
                </textarea>
                <div>
                  Optional: Customize field mappings in JSON format. Leave empty to use defaults.
                </div>
              </div>
            </div>
          </div>
          <button
            disabled=""
          >
            Upload & Preview Template
          </button>
          <div>
            <p
              font-weight="bold"
              mb="2"
            >
              ­ƒôØ Upload Instructions
            </p>
            <div
              color="gray.300"
              font-size="xs"
            >
              <p>
                1. Select the template type from the dropdown
              </p>
              <p>
                2. Choose your HTML template file (max 5MB)
              </p>
              <p>
                3. Optionally configure field mappings
              </p>
              <p>
                4. Click "Upload & Preview Template" to validate
              </p>
            </div>
          </div>
        </div>
      </div>
    </body>

      329 |       await user.click(uploadButton);
      330 |       
    > 331 |       await waitFor(() => {
          |                    ^
      332 |         expect(screen.getByText(/please select a file/i)).toBeInTheDocument();
      333 |       });
      334 |     });

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (src/components/TenantAdmin/TemplateManagement/__tests__/TemplateUpload.test.tsx:331:20)

  ÔùÅ TemplateUpload ÔÇ║ Form Validation ÔÇ║ shows error when uploading without template type

    Unable to find an element with the text: /please select a template type/i. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    <body>
      <div>
        <div>
          <div
            data-invalid="false"
          >
            <label>
              Template Type
            </label>
            <select
              aria-label="Template Type"
            >
              <option
                value=""
              >
                Select template type
              </option>
              <option
                value="str_invoice_nl"
              >
                STR Invoice (Dutch)
              </option>
              <option
                value="str_invoice_en"
              >
                STR Invoice (English)
              </option>
              <option
                value="btw_aangifte"
              >
                BTW Aangifte
              </option>
              <option
                value="aangifte_ib"
              >
                Aangifte IB
              </option>
              <option
                value="toeristenbelasting"
              >
                Toeristenbelasting
              </option>
              <option
                value="financial_report"
              >
                Financial Report
              </option>
            </select>
          </div>
          <div
            data-invalid="false"
          >
            <label>
              Template File
            </label>
            <input
              accept=".html,.htm"
              aria-label="Upload HTML template file"
              style="display: none;"
              type="file"
            />
            <div>
              <button>
                Change File
              </button>
              <div
                flex="2"
              >
                <p>
                  template.html
                </p>
                <p>
                  0.03
                   KB
                </p>
              </div>
            </div>
            <div>
              HTML files only, max 5MB
            </div>
          </div>
          <div>
            <button>
              Ôû╝
               Advanced: Field Mappings (Optional)
            </button>
            <div>
              <div
                data-invalid="false"
              >
                <label>
                  Field Mappings (JSON)
                </label>
                <textarea
                  aria-label="Field Mappings (JSON)"
                  placeholder="{\"field_name\": \"custom_value\"}"
                  rows="6"
                >
                  {}
                </textarea>
                <div>
                  Optional: Customize field mappings in JSON format. Leave empty to use defaults.
                </div>
              </div>
            </div>
          </div>
          <button
            disabled=""
          >
            Upload & Preview Template
          </button>
          <div>
            <p
              font-weight="bold"
              mb="2"
            >
              ­ƒôØ Upload Instructions
            </p>
            <div
              color="gray.300"
              font-size="xs"
            >
              <p>
                1. Select the template type from the dropdown
              </p>
              <p>
                2. Choose your HTML template file (max 5MB)
              </p>
              <p>
                3. Optionally configure field mappings
              </p>
              <p>
                4. Click "Upload & Preview Template" to validate
              </p>
            </div>
          </div>
        </div>
      </div>
    </body>

      349 |       await user.click(uploadButton);
      350 |       
    > 351 |       await waitFor(() => {
          |                    ^
      352 |         expect(screen.getByText(/please select a template type/i)).toBeInTheDocument();
      353 |       });
      354 |     });

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (src/components/TenantAdmin/TemplateManagement/__tests__/TemplateUpload.test.tsx:351:20)

  ÔùÅ TemplateUpload ÔÇ║ Upload Submission ÔÇ║ calls onUpload with field mappings when provided

    Expected repeat modifier or release modifier or "}" but found "c" in "{"custom_field": "value"}"
        See https://testing-library.com/docs/user-event/keyboard
        for more information about how userEvent parses your input.

      429 |       const textarea = screen.getByRole('textbox', { name: /field mappings \(json\)/i });
      430 |       await user.clear(textarea);
    > 431 |       await user.type(textarea, '{"custom_field": "value"}');
          |       ^
      432 |       
      433 |       // Click upload
      434 |       const uploadButton = screen.getByRole('button', { name: /upload & preview template/i });

      at readTag (node_modules/@testing-library/user-event/dist/cjs/utils/keyDef/readNextDescriptor.js:58:15)
      at Object.readNextDescriptor (node_modules/@testing-library/user-event/dist/cjs/utils/keyDef/readNextDescriptor.js:26:66)
      at Object.parseKeyDef (node_modules/@testing-library/user-event/dist/cjs/keyboard/parseKeyDef.js:18:118)
      at Object.keyboard (node_modules/@testing-library/user-event/dist/cjs/keyboard/index.js:8:33)
      at Object.type (node_modules/@testing-library/user-event/dist/cjs/utility/type.js:17:16)
      at Object.asyncWrapper (node_modules/@testing-library/react/dist/pure.js:88:22)
      at Object.<anonymous> (src/components/TenantAdmin/TemplateManagement/__tests__/TemplateUpload.test.tsx:431:7)

Test Suites: 1 failed, 1 total
Tests:       6 failed, 2 skipped, 17 passed, 25 total
Snapshots:   0 total
Time:        8.746 s
Ran all test suites matching /TemplateUpload.test.tsx/i.
